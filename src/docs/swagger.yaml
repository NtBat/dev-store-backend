openapi: 3.0.0
info:
  title: DevStore API
  version: 1.0.0
  description: API documentation for DevStore backend
  contact:
    name: DevStore Team

servers:
  - url: http://localhost:3333
    description: Development server
  - url: http://localhost:4000
    description: Alternative development server

tags:
  - name: Health
    description: Health check endpoints
  - name: Banners
    description: Banner management
  - name: Products
    description: Product management and catalog

paths:
  /ping:
    get:
      summary: Health check endpoint
      description: Returns a pong response to verify the API is running
      tags:
        - Health
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  pong:
                    type: boolean
                    example: true

  /banners:
    get:
      summary: Get all banners
      description: Retrieves all active banners with absolute image URLs
      tags:
        - Banners
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BannersResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /products:
    get:
      summary: Get all products
      description: Retrieves products with filtering, sorting, and limit options. Supports filtering by metadata (e.g., technology tags) using pipe-separated values.
      tags:
        - Products
      parameters:
        - in: query
          name: metadata
          schema:
            type: string
          description: |
            JSON string with metadata filters. Format: `{"categoryMetadataId": "value1|value2|value3"}`.
            Example: `{"tech": "react|node"}` filters products with React OR Node tags.
          example: '{"tech":"react|node"}'
        - in: query
          name: orderBy
          schema:
            type: string
            enum:
              - views
              - selling
              - price
          description: |
            Sort products by:
            - `views` - Most viewed (default)
            - `selling` - Best selling
            - `price` - Lowest price first
          example: views
        - in: query
          name: limit
          schema:
            type: string
            pattern: '^\d+$'
          description: Maximum number of products to return
          example: '10'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductsResponse'
        '400':
          description: Invalid query parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /products/{id}:
    get:
      summary: Get product by ID
      description: Retrieves detailed information about a specific product including all images, description, and category. Also increments the product view count.
      tags:
        - Products
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            pattern: '^\d+$'
          description: Product unique identifier
          example: '1'
      responses:
        '200':
          description: Successful response with product details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductDetailResponse'
        '400':
          description: Invalid product ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Product not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Product not found
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

components:
  schemas:
    Error:
      type: object
      properties:
        error:
          type: string
          description: Error message

    Banner:
      type: object
      properties:
        img:
          type: string
          description: Banner image URL
          example: http://localhost:3333/media/banners/banner-1.png
        link:
          type: string
          description: Banner redirect link
          example: /products/category

    BannersResponse:
      type: object
      properties:
        error:
          type: string
          nullable: true
          description: Error message (null if success)
        banners:
          type: array
          items:
            $ref: '#/components/schemas/Banner'

    Product:
      type: object
      properties:
        id:
          type: integer
          description: Product unique identifier
          example: 1
        label:
          type: string
          description: Product name/label
          example: Camisa React
        price:
          type: number
          format: float
          description: Product price
          example: 94.5
        image:
          type: string
          nullable: true
          description: Product image URL (first image)
          example: http://localhost:3333/media/products/camiseta-react-azul.png
        liked:
          type: boolean
          description: Whether the product is liked by the user (TODO - always false for now)
          example: false

    ProductsResponse:
      type: object
      properties:
        error:
          type: string
          nullable: true
          description: Error message (null if success)
        products:
          type: array
          items:
            $ref: '#/components/schemas/Product'

    ProductDetail:
      type: object
      properties:
        id:
          type: integer
          description: Product unique identifier
          example: 1
        label:
          type: string
          description: Product name/label
          example: Camisa React
        price:
          type: number
          format: float
          description: Product price
          example: 94.5
        description:
          type: string
          nullable: true
          description: Detailed product description
          example: Camisa com logo do React, ideal para front-end developers
        categoryId:
          type: integer
          description: Category ID reference
          example: 1
        images:
          type: array
          items:
            type: string
          description: Array of product image URLs
          example:
            - http://localhost:3333/media/products/camiseta-react-azul.png
            - http://localhost:3333/media/products/camiseta-react-preta.png

    Category:
      type: object
      properties:
        id:
          type: integer
          description: Category unique identifier
          example: 1
        name:
          type: string
          description: Category name
          example: Camisas
        slug:
          type: string
          description: Category URL slug
          example: camisas

    ProductDetailResponse:
      type: object
      properties:
        error:
          type: string
          nullable: true
          description: Error message (null if success)
        product:
          $ref: '#/components/schemas/ProductDetail'
        category:
          $ref: '#/components/schemas/Category'
